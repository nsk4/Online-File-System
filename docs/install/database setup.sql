DECLARE @CurrentMigration [nvarchar](max)

IF object_id('[dbo].[__MigrationHistory]') IS NOT NULL
    SELECT @CurrentMigration =
        (SELECT TOP (1) 
        [Project1].[MigrationId] AS [MigrationId]
        FROM ( SELECT 
        [Extent1].[MigrationId] AS [MigrationId]
        FROM [dbo].[__MigrationHistory] AS [Extent1]
        WHERE [Extent1].[ContextKey] = N'OnlineFileSystem.Migrations.Configuration'
        )  AS [Project1]
        ORDER BY [Project1].[MigrationId] DESC)

IF @CurrentMigration IS NULL
    SET @CurrentMigration = '0'

IF @CurrentMigration < '201701142132017_Initial'
BEGIN
    CREATE TABLE [dbo].[FileContents] (
        [FileContentId] [int] NOT NULL IDENTITY,
        [Data] [varbinary](max) NOT NULL,
        CONSTRAINT [PK_dbo.FileContents] PRIMARY KEY ([FileContentId])
    )
    CREATE TABLE [dbo].[Files] (
        [FileId] [int] NOT NULL IDENTITY,
        [Name] [nvarchar](max) NOT NULL,
        [Sharing] [int] NOT NULL,
        [Link] [nvarchar](max),
        [FileType] [nvarchar](max) NOT NULL,
        [Size] [bigint] NOT NULL,
        [DateCreated] [datetime] NOT NULL,
        [DateModified] [datetime] NOT NULL,
        [Content_FileContentId] [int] NOT NULL,
        [OwnerUserAccount_UserAccountId] [int] NOT NULL,
        [ParentFolder_FolderId] [int],
        CONSTRAINT [PK_dbo.Files] PRIMARY KEY ([FileId])
    )
    CREATE INDEX [IX_Content_FileContentId] ON [dbo].[Files]([Content_FileContentId])
    CREATE INDEX [IX_OwnerUserAccount_UserAccountId] ON [dbo].[Files]([OwnerUserAccount_UserAccountId])
    CREATE INDEX [IX_ParentFolder_FolderId] ON [dbo].[Files]([ParentFolder_FolderId])
    CREATE TABLE [dbo].[UserAccounts] (
        [UserAccountId] [int] NOT NULL IDENTITY,
        [Username] [nvarchar](max) NOT NULL,
        [Password] [nvarchar](max) NOT NULL,
        [PasswordSalt] [nvarchar](max) NOT NULL,
        [Email] [nvarchar](max) NOT NULL,
        [Role] [int] NOT NULL,
        [Confirmationlink] [nvarchar](max) NOT NULL,
        [DateCreated] [datetime] NOT NULL,
        [DateModified] [datetime] NOT NULL,
        [LastLogin] [datetime] NOT NULL,
        CONSTRAINT [PK_dbo.UserAccounts] PRIMARY KEY ([UserAccountId])
    )
    CREATE TABLE [dbo].[Folders] (
        [FolderId] [int] NOT NULL IDENTITY,
        [Name] [nvarchar](max) NOT NULL,
        [DateCreated] [datetime] NOT NULL,
        [DateModified] [datetime] NOT NULL,
        [OwnerUserAccount_UserAccountId] [int] NOT NULL,
        [ParentFolder_FolderId] [int],
        CONSTRAINT [PK_dbo.Folders] PRIMARY KEY ([FolderId])
    )
    CREATE INDEX [IX_OwnerUserAccount_UserAccountId] ON [dbo].[Folders]([OwnerUserAccount_UserAccountId])
    CREATE INDEX [IX_ParentFolder_FolderId] ON [dbo].[Folders]([ParentFolder_FolderId])
    CREATE TABLE [dbo].[AspNetRoles] (
        [Id] [nvarchar](128) NOT NULL,
        [Name] [nvarchar](256) NOT NULL,
        CONSTRAINT [PK_dbo.AspNetRoles] PRIMARY KEY ([Id])
    )
    CREATE UNIQUE INDEX [RoleNameIndex] ON [dbo].[AspNetRoles]([Name])
    CREATE TABLE [dbo].[AspNetUserRoles] (
        [UserId] [nvarchar](128) NOT NULL,
        [RoleId] [nvarchar](128) NOT NULL,
        CONSTRAINT [PK_dbo.AspNetUserRoles] PRIMARY KEY ([UserId], [RoleId])
    )
    CREATE INDEX [IX_UserId] ON [dbo].[AspNetUserRoles]([UserId])
    CREATE INDEX [IX_RoleId] ON [dbo].[AspNetUserRoles]([RoleId])
    CREATE TABLE [dbo].[AspNetUsers] (
        [Id] [nvarchar](128) NOT NULL,
        [Email] [nvarchar](256),
        [EmailConfirmed] [bit] NOT NULL,
        [PasswordHash] [nvarchar](max),
        [SecurityStamp] [nvarchar](max),
        [PhoneNumber] [nvarchar](max),
        [PhoneNumberConfirmed] [bit] NOT NULL,
        [TwoFactorEnabled] [bit] NOT NULL,
        [LockoutEndDateUtc] [datetime],
        [LockoutEnabled] [bit] NOT NULL,
        [AccessFailedCount] [int] NOT NULL,
        [UserName] [nvarchar](256) NOT NULL,
        CONSTRAINT [PK_dbo.AspNetUsers] PRIMARY KEY ([Id])
    )
    CREATE UNIQUE INDEX [UserNameIndex] ON [dbo].[AspNetUsers]([UserName])
    CREATE TABLE [dbo].[AspNetUserClaims] (
        [Id] [int] NOT NULL IDENTITY,
        [UserId] [nvarchar](128) NOT NULL,
        [ClaimType] [nvarchar](max),
        [ClaimValue] [nvarchar](max),
        CONSTRAINT [PK_dbo.AspNetUserClaims] PRIMARY KEY ([Id])
    )
    CREATE INDEX [IX_UserId] ON [dbo].[AspNetUserClaims]([UserId])
    CREATE TABLE [dbo].[AspNetUserLogins] (
        [LoginProvider] [nvarchar](128) NOT NULL,
        [ProviderKey] [nvarchar](128) NOT NULL,
        [UserId] [nvarchar](128) NOT NULL,
        CONSTRAINT [PK_dbo.AspNetUserLogins] PRIMARY KEY ([LoginProvider], [ProviderKey], [UserId])
    )
    CREATE INDEX [IX_UserId] ON [dbo].[AspNetUserLogins]([UserId])
    ALTER TABLE [dbo].[Files] ADD CONSTRAINT [FK_dbo.Files_dbo.FileContents_Content_FileContentId] FOREIGN KEY ([Content_FileContentId]) REFERENCES [dbo].[FileContents] ([FileContentId]) ON DELETE CASCADE
    ALTER TABLE [dbo].[Files] ADD CONSTRAINT [FK_dbo.Files_dbo.UserAccounts_OwnerUserAccount_UserAccountId] FOREIGN KEY ([OwnerUserAccount_UserAccountId]) REFERENCES [dbo].[UserAccounts] ([UserAccountId]) ON DELETE CASCADE
    ALTER TABLE [dbo].[Files] ADD CONSTRAINT [FK_dbo.Files_dbo.Folders_ParentFolder_FolderId] FOREIGN KEY ([ParentFolder_FolderId]) REFERENCES [dbo].[Folders] ([FolderId])
    ALTER TABLE [dbo].[Folders] ADD CONSTRAINT [FK_dbo.Folders_dbo.UserAccounts_OwnerUserAccount_UserAccountId] FOREIGN KEY ([OwnerUserAccount_UserAccountId]) REFERENCES [dbo].[UserAccounts] ([UserAccountId]) ON DELETE CASCADE
    ALTER TABLE [dbo].[Folders] ADD CONSTRAINT [FK_dbo.Folders_dbo.Folders_ParentFolder_FolderId] FOREIGN KEY ([ParentFolder_FolderId]) REFERENCES [dbo].[Folders] ([FolderId])
    ALTER TABLE [dbo].[AspNetUserRoles] ADD CONSTRAINT [FK_dbo.AspNetUserRoles_dbo.AspNetRoles_RoleId] FOREIGN KEY ([RoleId]) REFERENCES [dbo].[AspNetRoles] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[AspNetUserRoles] ADD CONSTRAINT [FK_dbo.AspNetUserRoles_dbo.AspNetUsers_UserId] FOREIGN KEY ([UserId]) REFERENCES [dbo].[AspNetUsers] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[AspNetUserClaims] ADD CONSTRAINT [FK_dbo.AspNetUserClaims_dbo.AspNetUsers_UserId] FOREIGN KEY ([UserId]) REFERENCES [dbo].[AspNetUsers] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[AspNetUserLogins] ADD CONSTRAINT [FK_dbo.AspNetUserLogins_dbo.AspNetUsers_UserId] FOREIGN KEY ([UserId]) REFERENCES [dbo].[AspNetUsers] ([Id]) ON DELETE CASCADE
    CREATE TABLE [dbo].[__MigrationHistory] (
        [MigrationId] [nvarchar](150) NOT NULL,
        [ContextKey] [nvarchar](300) NOT NULL,
        [Model] [varbinary](max) NOT NULL,
        [ProductVersion] [nvarchar](32) NOT NULL,
        CONSTRAINT [PK_dbo.__MigrationHistory] PRIMARY KEY ([MigrationId], [ContextKey])
    )
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201701142132017_Initial', N'OnlineFileSystem.Migrations.Configuration',  0x1F8B0800000000000400ED5D5B6FDCBA117E2FD0FF20E8A92D7C767D390952C37B0E1C273E351A5F90750EFA1670257A2D44973D92D6B15BF497F5A13FA97FA1A4EEBC93BABB2802045E89FC381C0EC999D170F89F7FFDFBECE7E7C0B79E609C7851B8B28F1687B605432772BD70BBB2F7E9C30FEFEC9F7FFAFDEFCE3EBAC1B3F56B59EE04974335C364653FA6E9EE74B94C9C4718806411784E1C25D143BA70A26009DC68797C78F8E7E5D1D11222081B6159D6D9E77D987A01CC7EA09F1751E8C05DBA07FE75E4423F299EA337EB0CD5BA01014C76C0812BFB36F4BD105E7A3E5CBF24290C167915DB3AF73D80C85943FFC1B6401846294811B1A75F12B84EE328DCAE77E801F0EF5F7610957B007E028B4E9CD6C575FB73788CFBB3AC2B9650CE3E49A3C010F0E8A460D092AEDE8ACD76C540C4C28F88D5E90BEE75C6C6958D7987389EC230B52DBABDD30B3FC665858C5E34AA1F5874A1834A469028E17F07D6C5DE4FF7315C85709FC6C03FB0EEF61BDF73FE0A5FEEA36F305C857BDF6F128C4846EF8807E8D15D1CED609CBE7C860F6C37AE5CDB5A92104B1AA342E057CFFB7C15A627C7B6758348021B1F5652D2E0CF3A8D62F80B0C610C52E8DE813485311AE42B17667C6608A19AFD005250B6F6DE0B418C6A5C83E74F30DCA68F2B1BFD695B97DE3374CB2705050C49CD66CE96F5202B87BEED984F3ED86D4779CCE1C5FF97ADA15507ADA27AC3FB25F4D0A28B2AA5F15E35DA6CABEB47903725EFA61CE493177EEB81747923783C701313F0C8FB3B6C30E8ED8FC60868EAC28B1862B92881F0A37B2F30A706574473CB7BF0DA80DD80276F9BC92B055B2DEB9FA19FBD4F1EBD5DBE276673F86B55E0328E82CF915F0C49F9FCEB3ADAC70EE653C479790FE22D4CF5A9B9FD8EA611DA7EE373C789F632B2D892147D74013EA14C29538AEF408C3A7A19F92E8CC5D492A5284A9B2FF954122578146A2FE704C7CC57F546F54917F7061D6DD678AAFA584B3D6E369C64B9BF0349F23D8ADDE95A5E033F1DBFF58F01F0FCF19BC553B7DBD68A16D0072F0E32B1F3FBD9665FEDDE456B1D20493F455B2F3444D257798B65BA85D29BD59C56EDCD4868A5F85635FFB755DFF908764735285707A48A10BF08AB6408CAF5AF0CE50D09D521F6B588D6FE54A2525AF3455B3CE9AF2BFFC979B2BB81E9A2ACB8C8212F630487B6BA6F8B26E281A55DAF5E258E75578993A3CDC3C9BB376F817BF2F64778F2A6CD8AD166ADB892691247C7EF8698B78AD5E2F8CDDB5E5A150A379E180957AA9BE3FDB528560B35FB9691694E915E441A43F52FD625EAFC451B53CA8A37B728EE505B53628AD950D23B6CBBDA1277BEDBA1C1CB440B73A48DF244414CAA45BD96355165DFE82E8A1AAD141649ADE7BC8F900882B0B545F817903C0EEE3D5C43671F23515DA720D80DDEDADD6314C29B7DB0C13360BCB67A1B9AFBEFD125709052FF31C4B53AE37D8A9C6FD13EFD18BA5829FE923AAC8EAC09D00B3948AD854972898419BA17B9AEDCC546C7ABD4D44AC9850FBC80AF9550EBE9D7B268AD99F04B30DA89A098A97190D9EC7AA49645C5A4E62594A416C54C49C5607A941625C58466059474E6A57AD3F9B211EA5FE9CB60E7AFF575DBBCC771034FA12C64C3D7D3A7348D967E05FEBEEFA65ACD86C259D8F76CC860E73F1B3232D1E3272F73B6689842656104AF559E6F65A9E71C45D9D8D381E8E6D88D8FB30688A6CB7992448E97CD82C657F6EA532F4939D2DE2CD977DFBC07E5A74ED40924D41EDEDE50C32BFB4F0C270478E5E647E1559F9F49D8239B96CBDBF003F4610AAD73270FA2BA0089035C7624104F5C82470D6E683089F1B74A7B2776BD76649BD057DB0026BCC273E09FC0632DECA8CA7DDDE061E14B36E0A2C2E73D7F3E125E744537F92EF51EF8C7F5C32B810F178B237AA9329B867A9D178757749C7E13749BE3651691287339D734921F3E86926B15611CE6B1EE6BD5E8206504E201F100F653254899F2C294D55CBCD0F176C0577289AAA96965E0BE576DD06F3EC01D0C71834A4EE834CEF7566302AA76A8415171C84010058E05D198ABBC0CF5B8334EE4516452E1DE10C86561620F2298728E8D209C7296E81020FCF232858016EE245D01A07D4B731350CAA92510D0C2EA1D4540498E4D20A0244B5E9D80E65E44DDF1A75C8A73134FD29739FEB62E65D704B249F06366A299BB07B08D8D6AC09815CF0F9BCC007FE6450B233A0B175A5278236811C1E06B98B2E76712DBAA3D133C6B9FD1BE59281186B272C39CE36110D69E8A8E4CCDE7525218000A80E2FB01539DD4CD1520F4C49201D6934F834B3C2066913120AEFC0425A5AED0AC0C60CBCF4552D8623FA4601BF38294AEFADC43A308EF5C043D4915EEB2AA1F951033D35CE120A310EA1945AFD964DF74FBCDC6130A182077E318B8C2CC592274DA34A0C859DE9D37A2684B0E7774DC5C468EAE2687CA1547C623856B6B702E91F19D420E897D38DA2EAC769CE17A6FD4506DA794921D728796A64BCB7C1A8DC7065E8424CB0795874BD7C7D5E842B11D4A382171493570385B6C67A688023458C6E8785C4C7C2ED402206790C23F226052D999DEB9546EF66A2EF1CC7E13C3BF139728235DC0A5B233BD73A99051359338A6A781F1D98945A4A1D8D3642B3F7956364DF5EE6C99A786281E9C2D053924CEAEC16EE785DB464E89E289B5CE134A5CFCB0364FB210E4184B87E0366D81552DA5510CB6907A8BCF85B9F0D28B93146705D800FCC1F7C20D98625C0B4EA050974D728C34762C4B05BBAC84FF2ECEACA8933F70ACDF02E7127536C02674165AC3D770D9DA16CEF6017C10CB13355C44FE3E08355240C830F32C0C4DA8FC098B70B6A43AC598F10C1B19670B3934DA03D7DF88B51C2AB331E20D8ED9A8E4E1974D8CFC893E429508A109523DD4C7C973213441F227FA0875A2039A27F953833E65890B880E654F8CA4BD3E2347097DFDC20CAF3E274703D66F66339B08BBA88F4925310435E696B4B688E9D429F726D7A5E7E755982133E9EAA7FA48F591F42652FDD41C293F62CE43CBDFE82316C72A9A50C5237D8CDCC9D684E0B9DD6408EC19F0261AFBF6354E6FE1725A1FF226D6D4FAF16C968AD24AEE65EBE59AFF3A9BAFA0A270B3A90E7B139B8DE0F0B80CA9FB163C1F699C4882443698B9FC109F0DCCA5485E5DC46F5A8A86929F894687B546FB1CA9EA7B4CFBD11243C876719E4A603672651012BDC7F1512654E4FA1931FAC397F98029118699617D6833F4115006ACF1CE5C73CB8F82F234B7FC8D81E9439EF7246C20F2950195CD539D0491CD17ADF0041CE597D06F813DC7D94467DF1AE865EC894E423F635FB7C0E6D04CBFD347E51CFA6C02735E9B5943ECFE553F9DCD2AC8F1CCF7BD89E59FEDBBED62028C6196C57E36C1C6A13AC23AAB1F1B6215C7E618B0E2F92C454AF8A5A59B48E5965E3791126088D720E24C1AB904490FD28931898366C4322F3B6827C63313DCA1C583FC12C3FAA4EB401A3DCF735D5EC7C18C3F2F71FCA874D00CCB15D30F0725A0E20342162959A21AD22A0C51ECEC401753457F496B37C46C548CE658B315BB0CBA28E04593A3127F2983AC70A0B6110351F4CF2B9307519C94AEF34B47268441325C2FD72B960B795C98AE6418FAFA86970E32204A5B32C86A5DA58217FDD489A304601BF66A533BD5F85BD9C51BAE971D65B84AF0D9F3EADCB93127FAD97A8C4589ADD465CB792D42248A1A1C757319597C985020BA48A51A174FAADF5528501186A3BE638689CBC98BD856A9E3AFEC420E7181C5FA37FFC2F7322DB72C700D42EF0126699EF9C33E3E3C3AA66EA899CF6D31CB247189BC7AF22B63C8719BECAA16AFD22564B97BCC330057B7B33C8178935DD0F287003CFFB1D71B585AB2B0FB052883302DF78EE50D84886BCE23887578C62251F79864D476B8C544484C9B9B4A3AF6AC71FBC8C6DBB6E91927D3B58B7EA47D65BA6E0D2630A61B63C81C36BB0A5DF8BCB2FF91219C5A577FFBCA0539B06E63B4989E5A87D63F8DC95269F366F4C9D13A112AD820CDE8E38288C8EA908A4B9CE965B2AB3E0659D4EA20A83EA63F7D63473F68CD5B38BA21129967BB41356FCB68B3CC89EECAE846D56C174FE6FE0B4D24D3FB2FDAA81CBD5D3E3173B563B6C2F1FF2D6C882D4C1C17354646D25254D9FC803DC8BF9ACFB8D3F8AFECF101B2DBBF84DE6F7BF4E21E3114B398CE77DCCF2A248F6E9A69FE7F7DAE22E9CDAB92E2DA7184C95B018CA8C9AB76A0A6F55D01AF7742719520D984689F6D7FE3992B46BC4CFB9D2C5C6E36FD4E889C8CF97DE1F5C2425146FC3658C26CF8BCDD5EA7B3FCECF86D481366C66FA38FD7F14FA6CB505973C2AD86138234C6923498453A9FBD89493FDE69A2B329C60DE03AA4116F2119AF2C03776FBBE31D9B60BB37EC29457B80ACDA448CD498D9AF194A5AA4C66D95A54D7E2CDCF0839065929F4D70BC996D523BE46B848C8166A9C799C09B3113594F2652F223B6869EE56144CA3C5E680CD9324CCB3E23E96A847D1826327F6D12263A18FABA64CC20657DAB74EA1C9C3C76622C0931182759708FA15C647DD469533BBA68AC2D6D5C811853BF195B1074B7A0398940CB2B0DE6728B419D4B559A6875F0CB0BC6BCAF40725E59D7A93E927075BBA6600689B5394971E52973C748A73DB6AC898E151A7CEC99FF950333133622BA60CA8B05C61636D181C3990B9BD1F5013393B5A9F6CF89254D7B0B1D51D0A868F9CA0B46679CA487B53838C109FC5624F9CF63E457B6BB899008E4FE56694A735E5BC25B0044E86A58C291C1A09347D3388D10B9E3945D280C19B613E5E9145E3704899969705237669A205FF31ACAAF34E5E7601535564F5C6183751171A3E2E4AF74C3CC22C6B4CB9490376BD6D742F99276B628236F56903259D676B1174BDB2ECAC8DB1624221EFA7A046AA16052BEB2CB1E6DCD531555A78474BB37C42D089C658549EE38498787BCDAA073A789F5B179D0B3B78E0F715B8106C1425FE5205DEDFD1E8276DD1C488407BE5F809B9D9C9FCE53AAE67250EA979D9930DE7D02444F141702A95C1A029EF06F019AF3F501BD3085D8D005C96CFA67CA50B705F4C2923EA78EC1ED00ECD15F645AA1DDCA0BF2A00F64DE25DEB686C0479B43E810465555E62A7C884ADB8EA2A82C4205B85CC314B8C8E23A8F53EF0138297A8D43F4B2B38E59D8130E14DD40F72ABCDDA7BB7D8ABA0C838D4FC40B611B51D67E76050249F3D9ED0EFF4AFAE80222D3C3A18DB7E1FBBDE7BB15DD979C901A0104363E8B80383C96290E8CDBBE54483751A80954B0AFB299EF61B0F31158721BAEC1136C431B12BF4F700B9C973A804A04A21E0892ED671F3CB08D41901418757DF413C9B01B3CFFF45F83395FA38BA50000 , N'6.1.3-40302')
END

